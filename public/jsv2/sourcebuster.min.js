!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.sbjs=e()}}(function(){return function e(r,t,a){function i(n,o){if(!t[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(s)return s(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var p=t[n]={exports:{}};r[n][0].call(p.exports,function(e){var t=r[n][1][e];return i(t||e)},p,p.exports,e,r,t,a)}return t[n].exports}for(var s="function"==typeof require&&require,n=0;n<a.length;n++)i(a[n]);return i}({1:[function(e,r,t){"use strict";var a=e("./init"),i={init:function(e){this.get=a(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};r.exports=i},{"./init":6}],2:[function(e,r,t){"use strict";var a=e("./terms"),i=e("./helpers/utils"),s={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",term:"trm"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){var r=e.source,t=e.medium,a=e.type;return"search.yahoo.com"==e.source&&"referral"==e.medium&&(r="yahoo",t="organic",a="organic"),"com.google.android.googlequicksearchbox"==e.source&&"referral"==e.medium&&(r="google",t="organic",a="organic"),s.aliases.main.type+"="+a+s.delimiter+s.aliases.main.source+"="+r+s.delimiter+s.aliases.main.medium+"="+t+s.delimiter+s.aliases.main.campaign+"="+e.campaign+s.delimiter+s.aliases.main.content+"="+e.content+s.delimiter+s.aliases.main.term+"="+e.term},extra:function(e){return s.aliases.extra.fire_date+"="+i.setDate(new Date,e)+s.delimiter+s.aliases.extra.entrance_point+"="+document.location.href+s.delimiter+s.aliases.extra.referer+"="+(document.referrer||a.none)},user:function(e,r){return s.aliases.udata.visits+"="+e+s.delimiter+s.aliases.udata.ip+"="+r+s.delimiter+s.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return s.aliases.session.pages_seen+"="+e+s.delimiter+s.aliases.session.current_page+"="+document.location.href},promo:function(e){return s.aliases.promo+"="+i.setLeadingZeroToInt(i.randomInt(e.min,e.max),e.max.toString().length)}}};r.exports=s},{"./helpers/utils":5,"./terms":9}],3:[function(e,r,t){"use strict";var a=e("../data").delimiter;r.exports={encodeData:function(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(r){try{return unescape(e)}catch(e){return""}}},set:function(e,r,t,a,i){var s,n;if(t){var o=new Date;o.setTime(o.getTime()+60*t*1e3),s="; expires="+o.toGMTString()}else s="";n=a&&!i?";domain=."+a:"",document.cookie=this.encodeData(e)+"="+this.encodeData(r)+s+n+"; path=/"},get:function(e){for(var r=this.encodeData(e)+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var i=t[a];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(r))return this.decodeData(i.substring(r.length,i.length))}return null},destroy:function(e,r,t){this.set(e,"",-1,r,t)},parse:function(e){var r=[],t={};if("string"==typeof e)r.push(e);else for(var i in e)e.hasOwnProperty(i)&&r.push(e[i]);for(var s=0;s<r.length;s++){var n;t[this.unsbjs(r[s])]={},n=this.get(r[s])?this.get(r[s]).split(a):[];for(var o=0;o<n.length;o++){var c=n[o].split("="),u=c.splice(0,1);u.push(c.join("=")),t[this.unsbjs(r[s])][u[0]]=this.decodeData(u[1])}}return t},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,r,t){"use strict";r.exports={parse:function(e){for(var r=this.parseOptions,t=r.parser[r.strictMode?"strict":"loose"].exec(e),a={},i=14;i--;)a[r.key[i]]=t[i]||"";return a[r.q.name]={},a[r.key[12]].replace(r.q.parser,function(e,t,i){t&&(a[r.q.name][t]=i)}),a},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var r={},t=(e||window.location.search.substring(1)).split("&"),a=0;a<t.length;a++){var i=t[a].split("=");if(void 0===r[i[0]])r[i[0]]=i[1];else if("string"==typeof r[i[0]]){var s=[r[i[0]],i[1]];r[i[0]]=s}else r[i[0]].push(i[1])}return r},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],5:[function(e,r,t){"use strict";r.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,r){var t=e.getTimezoneOffset()/60,a=e.getHours(),i=r||0===r?r:-t;return e.setHours(a+t+i),e.getFullYear()+"-"+this.setLeadingZeroToInt(e.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(e.getDate(),2)+" "+this.setLeadingZeroToInt(e.getHours(),2)+":"+this.setLeadingZeroToInt(e.getMinutes(),2)+":"+this.setLeadingZeroToInt(e.getSeconds(),2)},setLeadingZeroToInt:function(e,r){for(var t=e+"";t.length<r;)t="0"+t;return t},randomInt:function(e,r){return Math.floor(Math.random()*(r-e+1))+e}}},{}],6:[function(e,r,t){"use strict";var a=e("./data"),i=e("./terms"),s=e("./helpers/cookies"),n=e("./helpers/uri"),o=e("./helpers/utils"),c=e("./params"),u=e("./migrations");r.exports=function(e){function r(){var e;if(void 0!==v.utm_source||void 0!==v.utm_medium||void 0!==v.utm_campaign||void 0!==v.utm_content||void 0!==v.utm_term||void 0!==v.gclid||void 0!==v.yclid||void 0!==v[h.campaign_param])d(),e=t(i.traffic.utm);else if(f(i.traffic.organic))d(),e=t(i.traffic.organic);else if(!s.get(a.containers.session)&&f(i.traffic.referral))d(),e=t(i.traffic.referral);else{if(s.get(a.containers.first)||s.get(a.containers.current))return s.get(a.containers.current);d(),e=t(i.traffic.typein)}return e}function t(e){switch(e){case i.traffic.utm:b=i.traffic.utm,k=void 0!==v.utm_source?v.utm_source:void 0!==v.gclid?"google":void 0!==v.yclid?"yandex":i.none,w=void 0!==v.utm_medium?v.utm_medium:void 0!==v.gclid?"cpc":void 0!==v.yclid?"cpc":i.none,q=void 0!==v.utm_campaign?v.utm_campaign:void 0!==v[h.campaign_param]?v[h.campaign_param]:void 0!==v.gclid?"google_cpc":void 0!==v.yclid?"yandex_cpc":i.none,I=v.utm_content||i.none,j=p()||i.none;break;case i.traffic.organic:b=i.traffic.organic,k=k||n.getHost(document.referrer),w=i.referer.organic,q=i.none,I=i.none,j=i.none;break;case i.traffic.referral:b=i.traffic.referral,k=k||n.getHost(document.referrer),w=w||i.referer.referral,q=i.none,I=n.parse(document.referrer).path,j=i.none;break;case i.traffic.typein:b=i.traffic.typein,k=h.typein_attributes.source,w=h.typein_attributes.medium,q=i.none,I=i.none,j=i.none;break;default:b=i.oops,k=i.oops,w=i.oops,q=i.oops,I=i.oops,j=i.oops}var r={type:b,source:k,medium:w,campaign:q,content:I,term:j};return a.pack.main(r)}function p(){var e=document.referrer;if(v.utm_term)return v.utm_term;if(!(e&&n.parse(e).host&&n.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return n.getParam(n.parse(document.referrer).query).text}catch(e){return!1}}function f(e){var r=document.referrer;switch(e){case i.traffic.organic:return!!r&&l(r)&&m(r);case i.traffic.referral:return!!r&&l(r)&&g(r);default:return!1}}function l(e){if(h.domain){if(_)return n.getHost(e)!==n.getHost(y);var r=new RegExp("^(?:.*\\.)?"+o.escapeRegexp(y)+"$","i");return!n.getHost(e).match(r)}return n.getHost(e)!==n.getHost(document.location.href)}function m(e){var r="yandex",t="google",a=new RegExp("^(?:.*\\.)?"+o.escapeRegexp(r)+"\\..{2,9}$"),i=new RegExp(".*"+o.escapeRegexp("text")+"=.*"),s=new RegExp("^(?:www\\.)?"+o.escapeRegexp(t)+"\\..{2,9}$");if(n.parse(e).query&&n.parse(e).host.match(a)&&n.parse(e).query.match(i))return k=r,!0;if(n.parse(e).host.match(s))return k=t,!0;if(!n.parse(e).query)return!1;for(var c=0;c<h.organics.length;c++){if(n.parse(e).host.match(new RegExp("^(?:.*\\.)?"+o.escapeRegexp(h.organics[c].host)+"$","i"))&&n.parse(e).query.match(new RegExp(".*"+o.escapeRegexp(h.organics[c].param)+"=.*","i")))return k=h.organics[c].display||h.organics[c].host,!0;if(c+1===h.organics.length)return!1}}function g(e){if(!(h.referrals.length>0))return k=n.getHost(e),!0;for(var r=0;r<h.referrals.length;r++){if(n.parse(e).host.match(new RegExp("^(?:.*\\.)?"+o.escapeRegexp(h.referrals[r].host)+"$","i")))return k=h.referrals[r].display||h.referrals[r].host,w=h.referrals[r].medium||i.referer.referral,!0;if(r+1===h.referrals.length)return k=n.getHost(e),!0}}function d(){s.set(a.containers.current_extra,a.pack.extra(h.timezone_offset),x,y,_),s.get(a.containers.first_extra)||s.set(a.containers.first_extra,a.pack.extra(h.timezone_offset),x,y,_)}var h=c.fetch(e),v=n.getParam(),y=h.domain.host,_=h.domain.isolate,x=h.lifetime;u.go(x,y,_);var b,k,w,q,I,j;return function(){s.set(a.containers.current,r(),x,y,_),s.get(a.containers.first)||s.set(a.containers.first,s.get(a.containers.current),x,y,_);var e,t;s.get(a.containers.udata)?(e=parseInt(s.parse(a.containers.udata)[s.unsbjs(a.containers.udata)][a.aliases.udata.visits])||1,e=s.get(a.containers.session)?e:e+1,t=a.pack.user(e,h.user_ip)):(e=1,t=a.pack.user(e,h.user_ip)),s.set(a.containers.udata,t,x,y,_);var i;s.get(a.containers.session)?(i=parseInt(s.parse(a.containers.session)[s.unsbjs(a.containers.session)][a.aliases.session.pages_seen])||1,i+=1):i=1,s.set(a.containers.session,a.pack.session(i),h.session_length,y,_),h.promocode&&!s.get(a.containers.promocode)&&s.set(a.containers.promocode,a.pack.promo(h.promocode),x,y,_)}(),s.parse(a.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(e,r,t){"use strict";var a=e("./data"),i=e("./helpers/cookies");r.exports={go:function(e,r,t){var s,n=this.migrations,o={l:e,d:r,i:t};if(i.get(a.containers.first)||i.get(a.service.migrations)){if(!i.get(a.service.migrations))for(s=0;s<n.length;s++)n[s].go(n[s].id,o)}else{var c=[];for(s=0;s<n.length;s++)c.push(n[s].id);var u="";for(s=0;s<c.length;s++)u+=c[s]+"=1",s<c.length-1&&(u+=a.delimiter);i.set(a.service.migrations,u,o.l,o.d,o.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(e,r){var t=e+"=1",s=e+"=0",n=function(e,r,t){return r||t?e:a.delimiter};try{var o=[];for(var c in a.containers)a.containers.hasOwnProperty(c)&&o.push(a.containers[c]);for(var u=0;u<o.length;u++)if(i.get(o[u])){var p=i.get(o[u]).replace(/(\|)?\|(\|)?/g,n);i.destroy(o[u],r.d,r.i),i.destroy(o[u],r.d,!r.i),i.set(o[u],p,r.l,r.d,r.i)}i.get(a.containers.session)&&i.set(a.containers.session,a.pack.session(0),r.l,r.d,r.i),i.set(a.service.migrations,t,r.l,r.d,r.i)}catch(e){i.set(a.service.migrations,s,r.l,r.d,r.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(e,r,t){"use strict";var a=e("./terms"),i=e("./helpers/uri");r.exports={fetch:function(e){var r=e||{},t={};if(t.lifetime=this.validate.checkFloat(r.lifetime)||6,t.lifetime=parseInt(30*t.lifetime*24*60),t.session_length=this.validate.checkInt(r.session_length)||30,t.timezone_offset=this.validate.checkInt(r.timezone_offset),t.campaign_param=r.campaign_param||!1,t.user_ip=r.user_ip||a.none,r.promocode?(t.promocode={},t.promocode.min=parseInt(r.promocode.min)||1e5,t.promocode.max=parseInt(r.promocode.max)||999999):t.promocode=!1,r.typein_attributes&&r.typein_attributes.source&&r.typein_attributes.medium?(t.typein_attributes={},t.typein_attributes.source=r.typein_attributes.source,t.typein_attributes.medium=r.typein_attributes.medium):t.typein_attributes={source:"(direct)",medium:"(none)"},r.domain&&this.validate.isString(r.domain)?t.domain={host:r.domain,isolate:!1}:r.domain&&r.domain.host?t.domain=r.domain:t.domain={host:i.getHost(document.location.hostname),isolate:!1},t.referrals=[],r.referrals&&r.referrals.length>0)for(var s=0;s<r.referrals.length;s++)r.referrals[s].host&&t.referrals.push(r.referrals[s]);if(t.organics=[],r.organics&&r.organics.length>0)for(var n=0;n<r.organics.length;n++)r.organics[n].host&&r.organics[n].param&&t.organics.push(r.organics[n]);return t.organics.push({host:"bing.com",param:"q",display:"bing"}),t.organics.push({host:"search.yahoo.com",param:"p",display:"yahoo.com"}),t.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),t.organics.push({host:"about.com",param:"q",display:"about"}),t.organics.push({host:"aol.com",param:"q",display:"aol"}),t.organics.push({host:"ask.com",param:"q",display:"ask"}),t.organics.push({host:"globososo.com",param:"q",display:"globo"}),t.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),t.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),t.organics.push({host:"tut.by",param:"query",display:"tut.by"}),t.referrals.push({host:"t.co",display:"twitter.com"}),t.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),t},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(e,r,t){"use strict";r.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)});